{% extends 'base.html' %}

{% block content %}

<h2>Manage Firewalls</h2>

<div class="grid">
    <article>
        <h4>Refresh Detailed Specs</h4>
        <p>Manually re-poll all firewalls to update their detailed capacity specs.</p>
        <form action="{{ url_for('refresh_specs') }}" method="post" style="margin: 0;">
            <button type="submit" class="btn-small btn-panw">Refresh All Specs</button>
        </form>
    </article>
    <article>
        <h4>Import from Panorama</h4>
        <p>Imports connected firewalls from the Panorama configured in Settings.</p>
        <form action="{{ url_for('import_from_panorama') }}" method="post" style="margin: 0;">
            <button type="submit" class="btn-small btn-panw">Import from Panorama</button>
        </form>
    </article>
    <article>
        <h4>Add Single Firewall</h4>
        <form action="{{ url_for('add_firewall') }}" method="post">
            <label for="ip_address">IP Address</label>
            <input type="text" id="ip_address" name="ip_address" placeholder="e.g., 192.168.1.1" required>
            <button type="submit" class="btn-small btn-panw">Add Firewall</button>
        </form>
    </article>
    <article>
        <h4>Import from File</h4>
        <form action="{{ url_for('import_firewalls') }}" method="post" enctype="multipart/form-data">
            <label for="file">Firewall List (.txt)</label>
            <small>One IP address per line.</small>
            <input type="file" id="file" name="file" accept=".txt" required>
            <button type="submit" class="btn-small btn-panw">Import</button>
        </form>
    </article>
</div>

<hr>

<h3>Currently Monitored Firewalls</h3>
<form action="{{ url_for('delete_firewalls') }}" method="post" onsubmit="return confirm('Are you sure you want to delete the selected firewalls and all their stats?');">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="width: 5%;"><input type="checkbox" id="select-all"></th>
                    <th>IP Address</th>
                </tr>
            </thead>
            <tbody>
                {% for fw in firewalls %}
                <tr>
                    <td><input type="checkbox" name="firewall_ids" value="{{ fw.id }}" class="fw-checkbox"></td>
                    <td>{{ fw.ip_address }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="2">No firewalls have been added yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if firewalls %}
    <button type="submit" class="btn-small btn-panw">Delete Selected</button>
    {% endif %}
</form>

<script>
    document.getElementById('select-all').addEventListener('change', function(event) {
        const checkboxes = document.querySelectorAll('.fw-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = event.target.checked;
        });
    });

    document.querySelectorAll('.fw-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const allCheckboxes = document.querySelectorAll('.fw-checkbox');
            const allChecked = Array.from(allCheckboxes).every(cb => cb.checked);
            document.getElementById('select-all').checked = allChecked;
        });
    });
</script>
{% endblock %}