{% extends 'base.html' %}

{% block content %}

{# **CHANGE**: Updated CSS to be more specific and forceful #}
<style>
  .hover-dropdown {
    position: relative;
    display: inline-block;
  }
  .hover-dropdown ul {
    display: none;
    position: absolute;
    z-index: 100;
    width: max-content;
    min-width: 100%;
    background-color: var(--card-background-color);
    border: var(--card-border);
    box-shadow: var(--card-box-shadow);
    margin-top: 0;
    padding: 0.5rem 0; /* Vertical padding */
    margin-left: 0;
  }
  .hover-dropdown:hover ul {
    display: block;
  }
  /* This new, more specific rule will override the default list style */
  .hover-dropdown li {
    list-style-type: none !important;
    padding: 0 1rem; /* Add horizontal padding to align text */
  }
</style>

<h2>Manage Firewalls</h2>

<div class="hover-dropdown" style="margin-bottom: 1.5rem;">
    <a role="button" href="#">Export PDF Report</a>
    <ul>
        <li><small>Table Only</small></li>
        {# ** NEW: Added the 5-minute option ** #}
        <li><a href="{{ url_for('export_pdf', timespan='5m', type='table_only') }}">Last 5 Minutes</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='1h', type='table_only') }}">Last Hour</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='6h', type='table_only') }}">Last 6 Hours</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='24h', type='table_only') }}">Last 24 Hours</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='7d', type='table_only') }}">Last 7 Days</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='30d', type='table_only') }}">Last 30 Days</a></li>
        <li><hr></li>
        <li><small>Graphs Only</small></li>
        {# ** NEW: Added the 5-minute option ** #}
        <li><a href="{{ url_for('export_pdf', timespan='5m', type='graphs_only') }}">Last 5 Minutes</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='1h', type='graphs_only') }}">Last Hour</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='6h', type='graphs_only') }}">Last 6 Hours</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='24h', type='graphs_only') }}">Last 24 Hours</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='7d', type='graphs_only') }}">Last 7 Days</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='30d', type='graphs_only') }}">Last 30 Days</a></li>
        <li><hr></li>
        <li><small>Combined (Table + Graphs)</small></li>
        {# ** NEW: Added the 5-minute option ** #}
        <li><a href="{{ url_for('export_pdf', timespan='5m', type='combined') }}">Last 5 Minutes</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='1h', type='combined') }}">Last Hour</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='6h', type='combined') }}">Last 6 Hours</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='24h', type='combined') }}">Last 24 Hours</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='7d', type='combined') }}">Last 7 Days</a></li>
        <li><a href="{{ url_for('export_pdf', timespan='30d', type='combined') }}">Last 30 Days</a></li>
    </ul>
</div>

<div class="grid">
    <article>
        <h4>Refresh Detailed Specs</h4>
        <p>Manually re-poll all firewalls to update their detailed capacity specs.</p>
        <form action="{{ url_for('refresh_specs') }}" method="post">
            <button type="submit" class="contrast">Refresh All Specs</button>
        </form>
    </article>
    <article>
        <h4>Import from Panorama</h4>
        <p>Imports connected firewalls from the Panorama configured in Settings.</p>
        <form action="{{ url_for('import_from_panorama') }}" method="post">
            <button type="submit">Import from Panorama</button>
        </form>
    </article>
    <article>
        <h4>Add Single Firewall</h4>
        <form action="{{ url_for('add_firewall') }}" method="post">
            <label for="ip_address">IP Address</label>
            <input type="text" id="ip_address" name="ip_address" placeholder="e.g., 192.168.1.1" required>
            <button type="submit">Add Firewall</button>
        </form>
    </article>
    <article>
        <h4>Import from File</h4>
        <form action="{{ url_for('import_firewalls') }}" method="post" enctype="multipart/form-data">
            <label for="file">Firewall List (.txt)</label>
            <small>One IP address per line.</small>
            <input type="file" id="file" name="file" accept=".txt" required>
            <button type="submit">Import</button>
        </form>
    </article>
</div>

<hr>

<h3>Currently Monitored Firewalls</h3>
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>IP Address</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for fw in firewalls %}
            <tr>
                <td>{{ fw.ip_address }}</td>
                <td>
                    <form action="{{ url_for('delete_firewall', fw_id=fw.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this firewall and all its stats?');">
                        <button type="submit" class="secondary outline">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="2">No firewalls have been added yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}