{% extends 'base.html' %}

{% block content %}
<style>
/* ** NEW: Change link color to match brand theme ** */
  .table-container a {
      color: #ff4500;
  }
</style>

<h2>Firewall Status Dashboard</h2>

<p>Showing the latest statistics from the last successful poll. Auto-refreshes every {{ polling_interval }} seconds.</p>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Device-Name</th>
                <th>IP Address</th>
                <th>Model</th>
                {# ** NEW: Added Generation column header ** #}
                <th>Generation</th>
                <th>Last Updated</th>
                <th>Active Sessions</th>
                <th>CPU Load</th>
                <th>DP Load</th>
                <th>Total Input</th>
                <th>Total Output</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for stat in stats %}
            <tr>
                <td>
                    <strong>
                        <a href="{{ url_for('firewall_detail', fw_id=stat.firewall_id) }}">{{ stat.hostname or 'N/A' }}</a>
                    </strong>
                </td>
                <td><a href="{{ url_for('firewall_detail', fw_id=stat.firewall_id) }}">{{ stat.ip_address }}</a></td>
                <td>{{ stat.model or 'Discovering...' }}</td>
                {# ** NEW: Added Generation data cell ** #}
                <td>{{ stat.generation }}</td>
                <td>{{ stat.timestamp or 'N/A' }}</td>
                <td>{{ stat.active_sessions or 'N/A' }}</td>
                <td>{{ stat.cpu_load | round(2) }}%</td>
                <td>{{ stat.dataplane_load | round(2) }}%</td>
                <td>{{ (stat.total_input_mbps | default(0)) | round(2) }} Mbps</td>
                <td>{{ (stat.total_output_mbps | default(0)) | round(2) }} Mbps</td>
                <td>
                    {% if stat.status == 'success' %}
                        <span style="color: green;">● Online</span>
                    {% elif stat.status == 'error' %}
                        <span style="color: red;">○ Error</span>
                    {% else %}
                        <span style="color: gray;">- Pending</span>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            {# **CHANGE**: Updated colspan to account for the new column #}
            <td colspan="11">No statistics found. Add some firewalls and wait for the poller to run.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
    
<script>
    setTimeout(() => {
        window.location.reload();
    }, {{ polling_interval * 1000 }});
</script>

{% endblock %}