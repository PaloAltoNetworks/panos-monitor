<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PAN-OS Monitor</title>
    
    {# ** NEW: Link to your favicon ** #}
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        body { padding: 0; } /* Remove all body padding */
        nav.top-nav { 
            position: -webkit-sticky; /* For Safari */
            position: sticky;
            top: 0;
            z-index: 2; /* Ensure it's above other sticky elements */
            background-color: #2d2d2d; /* Dark background for the nav bar */
        }

        /* Style the brand/logo area */
        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* Space between logo and text */
        }

        /* ** NEW: Remove top margin from the nav bar to close the gap ** */
        nav.top-nav ul:first-of-type {
            margin-top: 0;
        }

        /* Override default Pico link colors for the dark nav bar */
        nav.top-nav ul li a {
            color: #f0f0f0; /* Light gray for links */
        }
        nav ul li a:hover {
            color: white;
        }
        nav ul li strong {
            color: white; /* White for the brand text */
        }


        /* Make table rows less tall */
        table td, table th {
            padding: 0.5rem 0.75rem;
        }

        /* Remove margin from forms inside table cells to keep rows compact */
        td form {
            margin-bottom: 0;
            display: inline-block; /* Prevent form from taking full width of cell */
        }

        /* Make buttons inside tables smaller for more compact rows */
        td form button,
        td a[role="button"],
        td button {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }

        /* Create a scrollable container for tables */
        .table-container {
            max-height: 70vh; /* Adjust height as needed */
            overflow-y: auto;
            position: relative; /* Needed for sticky headers */
        }

        /* Make table headers sticky */
        .table-container thead th {
            position: -webkit-sticky; /* For Safari */
            position: sticky;
            top: 0;
            z-index: 1;
            background-color: var(--card-background-color); /* Match theme background */
        }

        /* ** NEW: Make the active navigation link bold ** */
        nav.top-nav a[aria-current="page"] {
            color: #ff4500; /* Palo Alto Networks Red for active link */
        }

        /* ** NEW: A utility class for smaller, consistent buttons ** */
        .btn-small {
            font-size: 0.85rem !important;
            padding: 0.4rem 0.8rem !important;
        }

        /* ** NEW: Branded button color for primary actions ** */
        .btn-panw {
            background-color: #ff4500;
            border-color: #ff4500;
            color: #ffffff;
        }
        .btn-panw:hover {
            background-color: #e03e00; /* Darker red on hover */
            border-color: #e03e00;
        }

        /* ** NEW: Branded outline button color ** */
        .btn-panw-outline {
            border-color: #ff4500;
            color: #ff4500;
        }
        .btn-panw-outline:hover {
            background-color: #ff4500;
            border-color: #ff4500;
            color: #ffffff;
        }

        /* ** NEW: Pulsating animation for the status indicator ** */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }
        .status-indicator {
            color: white !important; /* White pulse for the dark background */
            font-weight: bold !important;
            animation: pulse 1.5s infinite;
        }
    </style>
  </head>
  <body>
    <nav class="top-nav">
        <div class="container-fluid">
            <ul>
                <li>
                    <div class="brand">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v6h-2zm0 8h2v2h-2z" fill="#ff4500"></path><path d="M11.25 12.55c0-.4.1-.77.29-1.1.19-.33.46-.6.8-.81.34-.21.74-.31 1.19-.31.45 0 .84.1 1.18.31.34.21.6.48.79.81.19.33.29.7.29 1.1v.19c0 .4-.1.77-.29 1.1-.19.33-.45.6-.79.81-.34-.21-.73.31-1.18.31-.45 0-.85-.1-1.19-.31-.34-.21-.61-.48-.8-.81-.19-.33-.29-.7-.29-1.1v-.19zm1.49 1.04c.1.13.23.23.39.31.16.08.34.12.53.12.19 0 .37-.04.53-.12.16-.08.29-.18.39-.31.1-.13.17-.28.21-.45.04-.17.06-.35.06-.53s-.02-.36-.06-.53c-.04-.17-.11-.32-.21-.45-.1-.13-.23-.23-.39-.31-.16-.08-.34-.12-.53-.12-.19 0-.37-.04-.53-.12-.16-.08-.29-.18-.39-.31-.1-.13-.17-.28-.21-.45-.04-.17-.06-.35-.06-.53s.02-.36.06-.53c.04-.17.11-.32.21-.45z" fill="#ff4500"></path></svg>
                        <strong>PAN-OS Monitor</strong>
                    </div>
                </li>
                <li><a href="{{ url_for('index') }}" {% if request.endpoint == 'index' %}aria-current="page"{% endif %}>Dashboard</a></li>
                <li><a href="{{ url_for('capacity_dashboard') }}" {% if request.endpoint == 'capacity_dashboard' %}aria-current="page"{% endif %}>Capacity</a></li>
                <li><a href="{{ url_for('alerts') }}" {% if request.endpoint == 'alerts' %}aria-current="page"{% endif %}>Alerts</a></li>
                <li><a href="{{ url_for('advisor') }}" {% if request.endpoint == 'advisor' %}aria-current="page"{% endif %}>Upgrade Advisor</a></li>
                <li><a href="{{ url_for('reports') }}" {% if request.endpoint == 'reports' %}aria-current="page"{% endif %}>Reports</a></li>
                <li><a href="{{ url_for('manage_firewalls') }}" {% if request.endpoint == 'manage_firewalls' %}aria-current="page"{% endif %}>Manage Firewalls</a></li>
                <li><a href="{{ url_for('manage_models') }}" {% if request.endpoint == 'manage_models' %}aria-current="page"{% endif %}>Manage Models</a></li>
                <li><a href="{{ url_for('settings') }}" {% if request.endpoint == 'settings' %}aria-current="page"{% endif %}>Settings</a></li>
                {# ** NEW: Background Task Status Indicator (Moved) ** #}
                {% if background_task_is_running %}
                <li><span aria-busy="true" class="status-indicator" style="font-size: 0.9rem;">Refreshing data...</span></li>
                {% endif %}
            </ul>
        </div>
    </nav>
    <main class="container" style="padding-top: 2rem;">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <article class="flash-{{ category }}">
                        {{ message }}
                    </article>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
        
        {# ** NEW: Auto-refresh script for background tasks ** #}
        {% if background_task_is_running %}
        <script>
            // If a background task is running, reload the page every 5 seconds to update the status
            setTimeout(() => {
                window.location.reload();
            }, 5000);
        </script>
        {% endif %}
    </main>
  </body>
</html>